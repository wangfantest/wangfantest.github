---
title: "DocFx学习笔记"
date: 2020-09-13
tags: ["笔记","DocFx"]
categories: ["Github碎片"]
---

1.DocFx是微软的一款开源的文档生成工具，下载地址如下:https://github.com/dotnet/docfx/releases

软件的官网是https://dotnet.github.io/docfx，在里面还可以获取到一些教程



2.此软件的运行需要.Net Framework 4.7.2环境，需要自行安装



3.创建一个DocFx工程

```
docfx init -q
```



4.建立网站

```
docfx docfx_project\docfx.json --serve
```



这样就可以通过访问http://localhost:8080来查看文档页面了，里面包含了一些基本的页面。



## docfx.json解析

docfx.json是docfx用于生成文档的配置文件，目前docfx.json只包含了两个键值对，分别是metadata和build。



metadata属性如下(暂时对我来说好像没什么用，我就不管了):

| Key                      |         Description          |
| :----------------------- | :--------------------------: |
| src                      |        工程源码的位置        |
| dest                     | 存放生成的metadata文件的目录 |
| force                    |                              |
| shouldSkipMarkup         |                              |
| filter                   |                              |
| useCompatibilityFileName |                              |
| properties               |                              |



build属性如下:

| Key                      | Description                                                  |
| :----------------------- | :----------------------------------------------------------- |
| content                  | 用于生成文档的全部文件                                       |
| resources                | 资源文件或者元数据文件，例如图片文件。                       |
| overwrite                | Contains all the conceptual files which contains yaml header with `uid` and is intended to override the existing metadata `yml` files. `name-files` file mapping with several ways to define it, as to be described in **Section4**. |
| globalMetadata           | 应用于每个文件的配置选项，例如在globalMetadata中定义`"_appTitle": "我是标题"`,则每个页面都会追加标题文本。 |
| fileMetadata             | Contains metadata that will be applied to specific files. `name-files` file mapping with several ways to define it, as to be described in **Section4**. |
| globalMetadataFiles      | Specify a list of JSON file path containing globalMetadata settings, as similar to `{"key":"value"}`. Please read **Section3.2.3** for detail. |
| fileMetadataFiles        | Specify a list of JSON file path containing fileMetadata settings, as similar to `{"key":"value"}`. Please read **Section3.2.3** for detail. |
| template                 | The templates applied to each file in the documentation. It can be a string or an array. The latter ones will override the former ones if the name of the file inside the template collides. If omitted, embedded `default` template will be used. |
| theme                    | The themes applied to the documentation. Theme is used to customize the styles generated by `template`. It can be a string or an array. The latter ones will override the former ones if the name of the file inside the template collides. If omitted, no theme will be applied, the default theme inside the template will be used. |
| xref                     | Specifies the urls of xrefmap used by content files. Currently, it supports following scheme: http, https, ftp, file, embedded. |
| xrefService              | Specifies the url patterns of xref service. Please read **Section3.2.4** for detail. |
| exportRawModel           | If set to true, data model to run template script will be extracted in `.raw.json` extension. |
| rawModelOutputFolder     | Specify the output folder for the raw model. If not set, the raw model will be generated to the same folder as the output documentation. |
| exportViewModel          | If set to true, data model to apply template will be extracted in `.view.json` extension. |
| viewModelOutputFolder    | Specify the output folder for the view model. If not set, the view model will be generated to the same folder as the output documentation. |
| dryRun                   | If set to true, template will not be actually applied to the documents. This option is always used with `--exportRawModel` or `--exportViewModel`, so that only raw model files or view model files are generated. |
| maxParallelism           | Set the max parallelism, 0 (default) is same as the count of CPU cores. |
| markdownEngineName       | Set the name of markdown engine, default is `dfm`, other available engines are `gfm` and `markdig`. |
| markdownEngineProperties | Set the parameters for markdown engine, value should be a JSON string. |
| noLangKeyword            | Disable default lang keyword, it can be downloaded from [here](http://dotnet.github.io/docfx/langwordmapping/langwordMapping.yml). |
| keepFileLink             | If set to true, docfx does not dereference (aka. copy) file to the output folder, instead, it saves a `link_to_path` property inside `manifest.json` to indicate the physical location of that file. A file link will be created by incremental build and copy resouce file. |
| sitemap                  | In format [SitemapOptions](https://dotnet.github.io/docfx/tutorial/docfx.exe_user_manual.html#325-sitemapoptions) Specifies the options for the sitemap.xml file. |
| disableGitFeatures       | Disable fetching Git related information for articles. Set to `true` if fetching git related information is slow for huge Git repositories. Default value is `false`. |

## 更换主题模板

我个人对官方默认的主题不是特别满意，我们可以去官网下载其它的主题模板。

下载完成后进行以下步骤使用模板

1. 在Doxfx网站根目录创建一个*templates*文件夹

2. 将主题文件夹拷贝至*templates*文件夹目录下

3. 在docfx.json中的template项中添加模板文件夹的路径，例如我使用的是mathew主题模板

   ```json
   {
       "template": [
           "default",
           "templates/mathew"
       ],
   }
   ```

主题文件夹中有一个main.css可以用来修改主题的一些属性

## 配置文档目录

docfx工程默认结构如下:

- *docfx_project/index.md*为主页的显示内容
- *docfx_project/toc.yml*为文档目录配置文件，对应*docfx_project/api*和*docfx_project/articles*这两个目录

我们可以通过修改*docfx_project/toc.yml*来配置文档目录，例如默认配置文件如下

```yml
- name: Articles
  href: articles/
- name: Api Documentation
  href: api/
  homepage: api/index.md
```

yml这种数据格式可能不太熟悉，其实和json差不多，转换成json如下

```json
[
  {
    "name": "Articles",
    "href": "articles/"
  },
  {
    "name": "Api Documentation",
    "href": "api/",
    "homepage": "api/index.md"
  }
]
```

在添加目录或者修改目录的时候，同时也要修改*docfx_project/docfx.json*中的content，因为content包含用于生成文档的全部文件。

## 开启搜索功能

如果想要开启程序自带的搜索功能，需要进行以下两步:

1. 程序其实预留了一些配置项，通过修改globalMetadata可以设置它们，在*docfx_project/docfx.json*中添加以下globalMetadata项

   ```json
   "globalMetadata": {
       "_enableSearch": "true",
   },
   ```

   这样我们就开启了页面上的搜索栏。

2. 程序如果要对生成后的HTML文件继续处理，可以通过添加postProcessors项来进行操作，在*docfx_project/docfx.json*中添加postProcessors项

   ```json
   "postProcessors": [
   	"ExtractSearchIndex"
   ],
   ```

   这表示程序会在生成HTML文件之后提取里面的单词生成一个数据库，可用于搜索。

------


程序完整的预留MetaData如下:

| Metadata名称         | 类型   | 描述                                                         |
| :------------------- | :----- | :----------------------------------------------------------- |
| _appTitle            | string | Will be appended to each output page's head title.           |
| _appFooter           | string | 页脚内容，如果未设置则默认为Generated by **DocFX**           |
| _appLogoPath         | string | Logo file's path from output root. Will show DocFX's logo if not specified. Remember to add file to resource. |
| _appFaviconPath      | string | Favicon file's path from output root. Will show DocFX's favicon if not specified. Remember to add file to resource. |
| _enableSearch        | bool   | 用于设置是否在页面上方显示搜索栏                             |
| _enableNewTab        | bool   | Indicate whether to open a new tab when clicking an external link. (internal link always shows within the current tab) |
| _disableNavbar       | bool   | Indicate whether to show the navigation bar on the top of page. |
| _disableBreadcrumb   | bool   | Indicate whether to show breadcrumb on the top of page.      |
| _disableToc          | bool   | Indicate whether to show table of contents on the left of page. |
| _disableAffix        | bool   | Indicate whether to show the affix bar on the right of page. |
| _disableContribution | bool   | Indicate whether to show the `View Source` and `Improve this Doc` buttons. |
| _gitContribute       | object | Customize the `Improve this Doc` URL button for public contributors. Use `repo` to specify the contribution repository URL. Use `branch` to specify the contribution branch. Use `apiSpecFolder` to specify the folder for new overwrite files. If not set, the git URL and branch of the current git repository will be used. |
| _gitUrlPattern       | string | Choose the URL pattern of the generated link for `View Source` and `Improve this Doc`. Supports `github` and `vso` currently. If not set, DocFX will try speculating the pattern from domain name of the git URL. |
| _noindex             | bool   | File(s) specified are not returned in search results         |

